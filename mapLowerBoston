<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Map of Places and Events</title>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
</head>
<body ng-app="mapApp" ng-controller="MapController as ctrl">
    <h1>Places and Events Map</h1>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
  <style>
    #map {
      height: 500px;
      width: 100%;
    }
  </style>
</head>
<body ng-app="mapApp" ng-controller="MapController as ctrl">

  <h1>Places and Events Map</h1>

  <form ng-submit="ctrl.addEvent()">
    <label for="name">Event Name:</label>
    <input type="text" id="name" ng-model="ctrl.newEvent.name" required>

    <label for="lat">Latitude:</label>
    <input type="number" id="lat" ng-model="ctrl.newEvent.lat" required>

    <label for="lng">Longitude:</label>
    <input type="number" id="lng" ng-model="ctrl.newEvent.lng" required>

    <button type="submit">Add Event</button>
  </form>

  <div id="map"></div>

  <script>
    const app = angular.module('mapApp', []);

    app.controller('MapController', ['$http', function($http) {
      const ctrl = this;
      ctrl.events = [];
      ctrl.newEvent = {};

      // Initialize map
      let map;
      let markers = [];

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: { lat: 42.3601, lng: -71.0589 }, // Default to Boston
          zoom: 12
        });

        // Fetch events from the database
        $http.get('/api/events').then((response) => {
          ctrl.events = response.data;
          ctrl.events.forEach(event => {
            const marker = new google.maps.Marker({
              position: { lat: parseFloat(event.lat), lng: parseFloat(event.lng) },
              map,
              title: event.name
            });
            markers.push(marker);
          });
        });
      }

      ctrl.addEvent = function() {
        if (ctrl.newEvent.name && ctrl.newEvent.lat && ctrl.newEvent.lng) {
          // Save to database
          $http.post('/api/events', ctrl.newEvent).then(() => {
            console.log('Event added successfully');

            // Add marker to the map
            const marker = new google.maps.Marker({
              position: { lat: parseFloat(ctrl.newEvent.lat), lng: parseFloat(ctrl.newEvent.lng) },
              map,
              title: ctrl.newEvent.name
            });

            markers.push(marker);
            ctrl.events.push(ctrl.newEvent);
            ctrl.newEvent = {};
          });
        }
      };

      window.initMap = initMap;
    }]);
  </script>

  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap" async defer></script>
</body>
</html>

